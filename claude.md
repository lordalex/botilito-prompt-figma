# Botilito Project - Claude Code Context

**Project Name:** Botilito
**Description:** Anti-misinformation platform with AI-powered content analysis
**Tech Stack:** React 18.3.1 + TypeScript + Vite 6.3.5 + Supabase
**Current Status:** Active Development
**Repository:** [github.com/lordalex/botilito-prompt-figma](https://github.com/lordalex/botilito-prompt-figma)

---

## ğŸ¯ Project Overview

Botilito is a platform designed to combat disinformation. The mascot is "Botilito," a reformed bot agent who escaped from a bot farm to fight against misinformation from digitalia.gov.co.

### Key Features:
- Content upload and review system
- AI-powered content analysis
- Human verification workflow
- Immunization studio
- Disinformation map (Mapa Desinfodemico)
- Browser extension integration
- User authentication with Supabase

---

## ğŸ—ï¸ Project Architecture

### Tech Stack Details:
- **Frontend Framework:** React 18.3.1 with TypeScript
- **Build Tool:** Vite 6.3.5
- **Styling:** Tailwind CSS v4.1.3
- **UI Components:** Radix UI + shadcn/ui pattern
- **Icons:** Lucide React
- **Authentication:** Supabase Auth
- **Package Manager:** npm (uses JSR registry for `@jsr/*` packages)

### Directory Structure:
```
botilito/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/              # Reusable UI components (50+ shadcn/ui components)
â”‚   â”‚   â”œâ”€â”€ extension/       # Browser extension components
â”‚   â”‚   â”œâ”€â”€ figma/           # Figma-generated components
â”‚   â”‚   â”œâ”€â”€ Login.tsx        # âœ… Supabase auth integrated
â”‚   â”‚   â”œâ”€â”€ Register.tsx     # âœ… Supabase auth integrated
â”‚   â”‚   â”œâ”€â”€ UserProfile.tsx
â”‚   â”‚   â”œâ”€â”€ Navigation.tsx
â”‚   â”‚   â”œâ”€â”€ ContentUpload.tsx
â”‚   â”‚   â”œâ”€â”€ ContentReview.tsx
â”‚   â”‚   â”œâ”€â”€ ContentAnalysisView.tsx
â”‚   â”‚   â”œâ”€â”€ HumanVerification.tsx
â”‚   â”‚   â”œâ”€â”€ ImmunizationStudio.tsx
â”‚   â”‚   â”œâ”€â”€ MapaDesinfodemico.tsx
â”‚   â”‚   â””â”€â”€ [20+ other components]
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts    # âœ… Supabase client singleton
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts      # âœ… Authentication utilities
â”‚   â”‚   â”‚   â””â”€â”€ info.tsx     # Autogenerated Supabase config
â”‚   â”‚   â””â”€â”€ caseCodeGenerator.ts
â”‚   â”œâ”€â”€ assets/              # Images and media
â”‚   â”œâ”€â”€ styles/              # Style definitions
â”‚   â”œâ”€â”€ App.tsx             # âœ… Main app with session management
â”‚   â”œâ”€â”€ main.tsx            # React entry point
â”‚   â””â”€â”€ index.css           # Tailwind CSS
â”œâ”€â”€ .env                     # âœ… Environment variables (VITE_ prefix)
â”œâ”€â”€ .claude/                 # Claude Code configuration
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ package.json
â””â”€â”€ SUPABASE_AUTH_PROGRESS.md  # âœ… Detailed auth implementation docs
```

---

## ğŸ” Authentication System (COMPLETED)

### Status: âœ… FULLY IMPLEMENTED - Ready for Testing

### Implementation Date: 2025-10-19

### Files Created:
1. **`src/utils/supabase/client.ts`**
   - Supabase client singleton
   - Session persistence enabled
   - Auto token refresh

2. **`src/utils/supabase/auth.ts`**
   - `signUp()`, `signIn()`, `signOut()`
   - `getSession()`, `getCurrentUser()`
   - `onAuthStateChange()` listener
   - Password reset utilities

### Components Updated:
- **Login.tsx**: Real Supabase auth + error handling + loading states
- **Register.tsx**: User creation with metadata storage
- **App.tsx**: Session checking + auth state listener + auto-restore

### User Metadata Schema:
```typescript
{
  name: string          // Full name
  phone: string         // Phone number
  location: string      // "City, Department" (Colombian locations)
  birth_date: string    // ISO date format
}
```

---

## ğŸ¨ UI/UX Improvements

### Smart Textarea with Auto-Expand (COMPLETED)

**Implementation Date:** 2025-01-20
**Branch:** `textfield` â†’ merged to `main`
**Component:** `src/components/ContentUpload.tsx`

#### Features:
- **Auto-detection**: Detects URL vs text content in real-time as user types/pastes
- **Smart expansion**: Dynamically adjusts from 1-6 rows based on content length
- **URL handling**: URLs stay compact at 1 row (under 200 chars)
- **Text expansion**:
  - Short text (50-150 chars): 2 rows
  - Medium text (150-300 chars): 3 rows
  - Long text (300-500 chars): 4 rows
  - Very long (500-800 chars): 5 rows
  - Extra long (800+ chars): 6 rows (max)
- **Newline support**: Each newline adds a row (capped at 6)
- **Smooth transitions**: 200ms animation between row changes
- **Prevents overflow**: No more text going outside the textarea

#### Key Changes:
- Added `textareaRows` state (line 39)
- Created `calculateTextareaRows()` function (lines 58-84)
- Created `handleContentChange()` handler with auto-detection (lines 86-103)
- Updated Textarea component to use dynamic rows (line 820)
- Fixed parent container to allow vertical growth (line 799)
- Reset functionality restores to 1 row (line 397)

#### Location:
`src/components/ContentUpload.tsx:762-822`

---

## ğŸ”‘ Important Configuration

### Environment Variables (.env)
**IMPORTANT:** This is a Vite project - use `VITE_` prefix, NOT `NEXT_PUBLIC_`

```env
# Frontend (Public)
VITE_SUPABASE_URL="https://mdkswlgcqsmgfmcuorxq.supabase.co"
VITE_SUPABASE_ANON_KEY="[key]"

# Backend (Secret)
SUPABASE_SERVICE_ROLE_KEY="[key]"
SUPABASE_DB_PASSWORD="[password]"

# Other APIs
GEMINI_API_KEY="[key]"
OPENROUTER_API_KEY="[key]"
GOOGLE_API_KEY="[key]"
NEBIUS_API_KEY="[key]"
```

### Supabase Configuration
- **Project URL:** https://mdkswlgcqsmgfmcuorxq.supabase.co
- **Project ID:** mdkswlgcqsmgfmcuorxq
- **Package:** `@jsr/supabase__supabase-js@2.49.8`
- **Import Path:** `@jsr/supabase__supabase-js` (NOT `@supabase/supabase-js`)

---

## ğŸ“¦ Key Dependencies

### UI & Components:
- `@radix-ui/*` - 15+ primitive components
- `lucide-react` - Icon library
- `tailwindcss` - Utility-first CSS
- `class-variance-authority` - Component variants
- `tailwind-merge` + `clsx` - Class utilities

### Forms & Input:
- `react-hook-form` - Form state management
- `react-day-picker` - Date selection
- `input-otp` - OTP input

### Notifications & UI Enhancement:
- `sonner` - Toast notifications
- `next-themes` - Theme management
- `motion` - Animations
- `embla-carousel-react` - Carousels
- `vaul` - Drawer component
- `react-resizable-panels` - Resizable layouts

### Data & Visualization:
- `recharts` - Chart library

### Other:
- `hono` - Web framework
- `@jsr/supabase__supabase-js` - Supabase client

---

## ğŸ¨ Design System

### Color Scheme:
- **Primary:** Yellow/Gold (Botilito brand color)
- **Secondary:** Gradient variations
- **Background:** White with subtle gradients

### Component Pattern:
- Uses **shadcn/ui** pattern (components in `src/components/ui/`)
- Built on **Radix UI** primitives
- Styled with **Tailwind CSS**

### Typography:
- Colombian Spanish language
- Casual, friendly tone ("Â¡Kiubo!", "Â¡Pa' dentro!")
- Character: Botilito (ex-bot agent fighting disinformation)

---

## ğŸš€ Development

### Start Dev Server:
```bash
npm run dev
```
- Runs on port 3000 (or 3001 if 3000 is occupied)
- Hot Module Replacement (HMR) enabled

### Build:
```bash
npm run build
```
- Output: `build/` directory
- Target: ESNext

### Preview Production Build:
```bash
npm run preview
```

---

## ğŸŒ Application Flow

### Authentication Flow:
```
1. App mounts â†’ Check for existing session
2. No session â†’ Show Login/Register
3. User registers â†’ Create Supabase account â†’ Auto-login
4. User logs in â†’ Authenticate â†’ Set session
5. Session exists â†’ Show main app
6. Auth state change â†’ Update UI automatically
7. User logs out â†’ Clear session â†’ Return to login
```

### Main App Tabs:
- **Upload** - Content upload
- **Review** - Content review queue
- **Analysis** - AI content analysis
- **Verification** - Human verification
- **Immunization** - Immunization studio
- **Mapa** - Disinformation map
- **Docs** - Documentation
- **Profile** - User profile
- **Extension** - Browser extension

---

## ğŸ‡¨ğŸ‡´ Colombian Context

### Colombian Departments (for registration):
The app includes all 32 Colombian departments in the registration form:
- Amazonas, Antioquia, Arauca, AtlÃ¡ntico, BolÃ­var, BoyacÃ¡, Caldas, CaquetÃ¡, Casanare, Cauca, Cesar, ChocÃ³, CÃ³rdoba, Cundinamarca, GuainÃ­a, Guaviare, Huila, La Guajira, Magdalena, Meta, NariÃ±o, Norte de Santander, Putumayo, QuindÃ­o, Risaralda, San AndrÃ©s y Providencia, Santander, Sucre, Tolima, Valle del Cauca, VaupÃ©s, Vichada

### Language & Tone:
- **Primary Language:** Spanish (Colombian variant)
- **Tone:** Friendly, casual, youth-oriented
- **Character Voice:** Botilito speaks informally ("parce", "kiubo", "pa' dentro")

---

## ğŸ”§ Code Conventions

### Import Statements:
1. React imports first
2. Component imports
3. UI component imports
4. Icon imports
5. Asset imports (figma:asset/...)
6. Utility imports

### Component Pattern:
```typescript
interface ComponentProps {
  // Props definition
}

export function Component({ props }: ComponentProps) {
  // State
  // Effects
  // Handlers
  // Render
}
```

### State Management:
- Currently using React `useState` and `useEffect`
- No global state management library (Redux, Zustand, etc.)
- Auth state managed in `App.tsx`

---

## ğŸ“ Current Status & Next Steps

### âœ… Completed:
- [x] Project setup with Vite + React + TypeScript
- [x] UI component library (50+ components)
- [x] Supabase integration
- [x] Complete authentication system
- [x] Login/Register forms with validation
- [x] Session management and persistence
- [x] Main app navigation and routing
- [x] Smart textarea with auto-expand (ContentUpload.tsx)
- [x] AI content analysis integration with Supabase Edge Functions
- [x] Asynchronous job processing with polling
- [x] Consensus scoring system (AI Only, Human Consensus, Conflicted)
- [x] Comprehensive documentation suite

### ğŸ”„ In Progress:
- [ ] Mapa DesinfodÃ©mico - API integration (using mock data fallback)
- [ ] Content review workflow refinement
- [ ] Human verification system

### ğŸ”œ Next Priorities:

**Priority 1 - Features:**
1. Complete Mapa DesinfodÃ©mico API integration
2. Implement content review workflow
3. Build immunization studio
4. Browser extension integration

**Priority 2 - User Experience:**
1. Add password reset flow
2. Enhance UserProfile with metadata display
3. Add email verification handling
4. Implement profile editing

**Priority 3 - Production:**
1. Comprehensive testing suite
2. Performance optimization
3. Production deployment setup

---

## ğŸ› Known Issues & Gotchas

### 1. Supabase Import Path:
- âŒ WRONG: `import { createClient } from '@supabase/supabase-js'`
- âœ… CORRECT: `import { createClient } from '@jsr/supabase__supabase-js'`

### 2. Environment Variables:
- âŒ WRONG: `NEXT_PUBLIC_*` (this is NOT Next.js)
- âœ… CORRECT: `VITE_*` (Vite requires this prefix)

### 3. Figma Assets:
- Assets use custom import path: `figma:asset/[hash].png`
- These are handled by Vite's import system

### 4. Port Configuration:
- Default port 3000 may be occupied
- Vite auto-increments to 3001, 3002, etc.

---

## ğŸ“š Reference Documentation

### External Resources:
- [Supabase Auth Docs](https://supabase.com/docs/guides/auth)
- [Vite Documentation](https://vite.dev)
- [Tailwind CSS v4](https://tailwindcss.com)
- [Radix UI](https://www.radix-ui.com)
- [shadcn/ui](https://ui.shadcn.com)

### Internal Documentation:
- `SUPABASE_AUTH_PROGRESS.md` - Detailed auth implementation guide
- `.claude/settings.local.json` - Claude Code settings

---

## ğŸ’¡ Tips for Working on This Project

### When Adding Authentication Features:
- Use utilities from `src/utils/supabase/auth.ts`
- Always handle errors with try/catch
- Show loading states during async operations
- Display user-friendly error messages in Spanish

### When Creating New Components:
- Follow the shadcn/ui pattern (components in `ui/` folder)
- Use Lucide React for icons
- Apply Tailwind classes for styling
- Keep Spanish language for user-facing text

### When Working with Forms:
- Consider using `react-hook-form` (already installed)
- Add proper validation
- Show inline error messages
- Use Colombian Spanish error messages

### When Modifying Auth Flow:
- Test session persistence
- Verify auth state changes propagate
- Check metadata is properly stored
- Ensure logout cleans up completely

---

## ğŸ¯ Project Goals

### Mission:
Fight disinformation in Colombia through AI-powered content analysis and community verification.

### Target Users:
- Content creators
- Fact-checkers
- Educators
- General public concerned about misinformation

### Key Differentiators:
- Colombian context and language
- Friendly, approachable character (Botilito)
- Community-driven verification
- Educational focus (immunization studio)

---

## ğŸ“ Quick Commands

```bash
# Start development
npm run dev

# Build for production
npm run build

# Preview production build
npm run preview

# Check current branch
git branch

# Switch to login branch
git checkout login

# View recent commits
git log --oneline -10
```

---

**Last Updated:** 2025-12-16
**Current Focus:** Documentation Enhancement & Active Development

---

## ğŸ§  Memory Notes

### Recent Changes (2025-12-16):
1. Comprehensive documentation overhaul
2. Created LICENSE file (MIT)
3. Created CONTRIBUTING.md with contribution guidelines
4. Created SECURITY.md with security policies
5. Filled Guidelines.md with complete design system
6. Expanded Attributions.md with all dependencies
7. Updated README.md with deployment, security, and additional documentation sections

### Previous Major Updates:
- AI content analysis integration with Supabase Edge Functions
- Asynchronous job processing with polling (3s intervals)
- Consensus scoring system implementation
- Smart auto-expand textarea in ContentUpload.tsx
- Complete Supabase authentication system

### Important Context for Development:
- All core documentation is now complete and up-to-date
- Mapa DesinfodÃ©mico using mock data while API stabilizes
- Authentication system fully implemented and tested
- 50+ UI components from shadcn/ui available
- Content upload/review features in active development
